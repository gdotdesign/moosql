<!DOCTYPE html>  <html> <head>   <title>moosql.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               moosql.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-1">#</a>               </div>               <h1>MooSql</h1>

<p>Class wrapper for HTML5 SQL Storage</p>

<p>More information on HTML5 SQL Storage http://dev.w3.org/html5/webdatabase/</p>

<h2>How to use</h2>

<pre><code>    //Create an instance.
    var sqlDB = new MooSQL({
        //Database name
        dbName:'Test',
        //Database version (max 4 numbers seperated by dots)
        dbVersion:'1.0',
        //Database description (officially database display name)
        dbDesc:'This is a test Database',
        //Estimated size
        dbSize:20*100
    })
    sqlDB.addEvent('databaseReady',function(){
        //Execute some SQL statement, callback is needed
        sqlDB.exec("SELECT * FROM 'sometable'",callback.bindWithEvent());
    })

    //Callback function
    function callback(transaction,result){
       log(result.rows.item(0));
    }
</code></pre>

<h2>Events</h2>

<p>databaseReady - fires when the database is ready for work.</p>

<p>databaseCreated - fires when the database created if there is none.</p>

<p>notSupported - fires if the browser not supports SQL storage</p>

<p>transactionError - fires if something goes wrong with the transation, 1 argument(SQLException)</p>

<p>statmentError - fires if the statement is invalid , 1 argument(SQLException)</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-2">#</a>               </div>               <h2>Options</h2>

<ul>
<li><strong>dbName</strong>: Database name.</li>
<li><strong>dbVersion</strong>: DaDatabase version (max 4 numbers seperated by dots).</li>
<li><strong>dbDesc</strong>: Database description (officially database display name).</li>
<li><strong>dbSize</strong>: Estimated size.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">MooSQL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Class</span> <span class="p">{</span>
  <span class="nv">Implements : </span><span class="p">[</span><span class="nx">Options</span><span class="p">,</span> <span class="nx">Events</span><span class="p">]</span>
  <span class="nv">options: </span><span class="p">{</span>
    <span class="nv">dbName: </span><span class="s1">&#39;&#39;</span>
    <span class="nx">dbVersion</span><span class="o">:</span><span class="s1">&#39;&#39;</span>
    <span class="nx">dbDesc</span><span class="o">:</span><span class="s1">&#39;&#39;</span>
    <span class="nx">dbSize</span><span class="o">:</span><span class="mi">20</span><span class="o">*</span><span class="mi">100</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-3">#</a>               </div>               <h2>Constructor</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initialize: </span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-4">#</a>               </div>               <p>Set options.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@setOptions</span> <span class="nx">options</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-5">#</a>               </div>               <p>Check for sqllite database support.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nb">window</span><span class="p">.</span><span class="nx">openDatabase</span> <span class="o">isnt</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-6">#</a>               </div>               <p>Open the database.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@db</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">openDatabase</span><span class="p">(</span>
        <span class="nx">@options</span><span class="p">.</span><span class="nx">dbName</span>
        <span class="nx">@options</span><span class="p">.</span><span class="nx">dbVersion</span>
        <span class="nx">@options</span><span class="p">.</span><span class="nx">dbDesc</span>
        <span class="nx">@options</span><span class="p">.</span><span class="nx">dbSize</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-7">#</a>               </div>               <p>Callback for database creation.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">(</span> <span class="p">(</span><span class="nx">db</span><span class="p">)</span> <span class="o">-&gt;</span>
          <span class="nx">@db</span> <span class="o">=</span> <span class="nx">db</span>
          <span class="nx">@fireEvent</span> <span class="s1">&#39;databaseCreated&#39;</span>
        <span class="p">).</span><span class="nx">bind</span> <span class="err">@</span>
      <span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-8">#</a>               </div>               <p>If there is a database fire the ready event.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@db</span> <span class="o">isnt</span> <span class="kc">null</span>
      <span class="nx">@fireEvent</span> <span class="s1">&#39;databaseReady&#39;</span>
    <span class="k">else</span>
      <span class="nx">@fireEvent</span> <span class="s1">&#39;notSupported&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-9">#</a>               </div>               <p>Return "this".</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="err">@</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-10">#</a>               </div>               <h2>exec</h2>

<p>Basic sql statement execution function (asynchronous).</p>

<h3>Arguments:</h3>

<ul>
<li><strong>statement</strong>: A valid SQL statement.</li>
<li><strong>callback</strong>:  Runs either when the transtaction successfull, when there is a statement error
or when is a transation error.</li>
<li><strong>args</strong>: Addition arguments.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">exec: </span><span class="p">(</span><span class="nx">statement</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">@db</span><span class="p">.</span><span class="nx">transaction</span> <span class="p">((</span><span class="nx">tr</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="nx">tr</span><span class="p">.</span><span class="nx">executeSql</span><span class="p">(</span>
        <span class="nx">statement</span>
        <span class="nx">args</span>
        <span class="nx">callback</span> <span class="o">or</span> <span class="o">-&gt;</span>
        <span class="p">((</span><span class="nx">tr</span><span class="p">,</span><span class="nx">err</span><span class="p">)</span> <span class="o">-&gt;</span>
          <span class="nx">callback</span><span class="p">.</span><span class="nx">run</span><span class="p">([</span><span class="nx">tr</span><span class="p">,</span><span class="nx">err</span><span class="p">])</span>
          <span class="nx">@fireEvent</span><span class="p">(</span><span class="s1">&#39;statementError&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
          <span class="kc">false</span>
        <span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="err">@</span><span class="p">))</span>
      <span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="err">@</span><span class="p">),</span>
      <span class="p">(</span> <span class="p">(</span><span class="nx">tr</span><span class="p">,</span><span class="nx">err</span><span class="p">)</span> <span class="o">-&gt;</span>
       <span class="nx">callback</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="nx">tr</span><span class="p">,</span><span class="nx">err</span><span class="p">)</span>
       <span class="nx">@fireEvent</span><span class="p">(</span><span class="s1">&#39;transactionError&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
       <span class="kc">false</span>
       <span class="p">).</span><span class="nx">bind</span> <span class="err">@</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-11">#</a>               </div>               <h2>like</h2>

<p>Runs a select statement with LIKE.</p>

<h3>Arguments:</h3>

<ul>
<li><strong>table</strong>: The name of the table.</li>
<li><strong>what</strong>: Columns for selecting.</li>
<li><strong>where</strong>: Key, value pair specifing the arguments for the WHERE clause .</li>
<li><strong>callback</strong>: The callback function.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">like: </span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">what</span><span class="p">,</span> <span class="nx">Where</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">Where</span> <span class="o">is</span> <span class="kc">null</span>
      <span class="nx">wheremap</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span>
      <span class="nx">wheremap</span> <span class="o">=</span> <span class="nx">@likeMap</span> <span class="nx">Where</span>
    <span class="nx">@exec</span> <span class="s2">&quot;SELECT &quot;</span><span class="o">+</span><span class="nx">$splat</span><span class="p">(</span><span class="nx">what</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; FROM &#39;#{table}&#39; &quot;</span><span class="o">+</span><span class="p">(</span><span class="k">if</span> <span class="nx">Where</span> <span class="o">is</span> <span class="kc">null</span><span class="o">?</span> <span class="k">then</span> <span class="s1">&#39;;&#39;</span> <span class="k">else</span> <span class="s2">&quot;WHERE #{wheremap};&quot;</span><span class="p">),</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-12">#</a>               </div>               <h2>findAll</h2>

<p>Selects everything from the specified tables.</p>

<h3>Arguments:</h3>

<ul>
<li><strong>tables</strong>: The name of the tables.</li>
<li><strong>callback</strong>: The callback function.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">findAll: </span><span class="p">(</span><span class="nx">tables</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="nx">$splat</span><span class="p">(</span><span class="nx">tables</span><span class="p">).</span><span class="nx">each</span> <span class="p">(</span><span class="nx">item</span><span class="p">,</span><span class="nx">i</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="k">if</span> <span class="nx">i</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nx">query</span> <span class="o">+=</span><span class="s2">&quot;SELECT *, &#39;#{item}&#39; AS type FROM &#39;#{item}&#39; &quot;</span>
      <span class="k">else</span>
        <span class="nx">query</span> <span class="o">+=</span><span class="s2">&quot;union SELECT *, &#39;#{item}&#39; AS type FROM &#39;#{item}&#39; &quot;</span>
    <span class="nx">@exec</span> <span class="s2">&quot;#{query};&quot;</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-13">#</a>               </div>               <h2>findA</h2>

<p>Selects everything from a table.</p>

<h3>Arguments:</h3>

<ul>
<li><strong>table</strong>: The name of the table.</li>
<li><strong>callback</strong>: The callback function.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">findA: </span><span class="p">(</span><span class="nx">table</span><span class="p">,</span><span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">@exec</span> <span class="s2">&quot;SELECT * FROM &#39;&quot;</span><span class="o">+</span><span class="nx">table</span><span class="o">+</span><span class="s2">&quot;&#39;;&quot;</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-14">#</a>               </div>               <h2>find</h2>

<p>Runs a SELECT query.</p>

<h3>Arguments:</h3>

<ul>
<li><strong>table</strong>: The name of the table.</li>
<li><strong>what</strong>: Columns for selecting.</li>
<li><strong>where</strong>: Key, value pair specifing the arguments for the WHERE clause.</li>
<li><strong>callback</strong>: The callback function.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">find: </span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">what</span><span class="p">,</span> <span class="nx">Where</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">Where</span> <span class="o">is</span> <span class="kc">null</span>
      <span class="nx">wheremap</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span>
      <span class="nx">wheremap</span> <span class="o">=</span> <span class="nx">@whereMap</span> <span class="nx">Where</span>
    <span class="nx">@exec</span> <span class="s2">&quot;SELECT &quot;</span><span class="o">+</span><span class="nx">$splat</span><span class="p">(</span><span class="nx">what</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; FROM &#39;#{table}&#39; &quot;</span><span class="o">+</span><span class="p">(</span><span class="k">if</span> <span class="nx">Where</span> <span class="o">is</span> <span class="kc">null</span><span class="o">?</span> <span class="k">then</span> <span class="s1">&#39;;&#39;</span> <span class="k">else</span> <span class="s2">&quot;WHERE #{wheremap};&quot;</span><span class="p">),</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-15">#</a>               </div>               <h2>tableExists</h2>

<p>Checks for a table with the given name.
If there isn't an error the table exists.</p>

<h3>Arguments:</h3>

<ul>
<li><strong>table</strong>: The name of the table.</li>
<li><strong>callback</strong>: The callback function.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tableExists: </span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">@exec</span> <span class="s2">&quot;select * from #{name}&quot;</span><span class="p">,</span><span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-16">#</a>               </div>               <h2>create</h2>

<p>Creates a table.</p>

<h3>Arguments:</h3>

<ul>
<li><strong>table</strong>: The name of the table.</li>
<li><strong>callback</strong>: The callback function.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">create: </span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">valuesmap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hash</span><span class="p">(</span><span class="nx">values</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">value</span><span class="p">,</span><span class="nx">key</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="s1">&#39;&quot;&#39;</span><span class="o">+</span><span class="nx">key</span><span class="o">+</span><span class="s1">&#39;&quot; &#39;</span><span class="o">+</span><span class="nx">$splat</span><span class="p">(</span><span class="nx">value</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="nx">values</span> <span class="o">=</span> <span class="nx">$splat</span><span class="p">(</span><span class="nx">valuesmap</span><span class="p">.</span><span class="nx">getValues</span><span class="p">()).</span><span class="nx">join</span> <span class="s1">&#39;, &#39;</span>
    <span class="nx">@exec</span> <span class="s2">&quot;CREATE TABLE &#39;#{table}&#39; ( #{values} )&quot;</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-17">#</a>               </div>               <h2>save</h2>

<p>Saves a record in a table. If there isn't a record inserts it.</p>

<h3>Arguments:</h3>

<ul>
<li><strong>table</strong>: The name of the table.</li>
<li><strong>set</strong>: Key value pairs for the SET.</li>
<li><strong>where</strong>: Key, value pairs specifing the arguments for the WHERE clause.</li>
<li><strong>callback</strong>: The callback function</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">save: </span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">Where</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">@find</span> <span class="nx">table</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="nx">Where</span><span class="p">,</span> <span class="p">(</span> <span class="p">(</span><span class="nx">tr</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="k">if</span> <span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="nx">@update</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">Where</span><span class="p">,</span> <span class="nx">callback</span>
      <span class="k">else</span>
        <span class="nx">@insert</span> <span class="nx">table</span><span class="p">,</span> <span class="nx">$extend</span><span class="p">(</span><span class="nx">set</span><span class="p">,</span><span class="nx">Where</span><span class="p">),</span> <span class="nx">callback</span>
      <span class="p">).</span><span class="nx">bindWithEvent</span> <span class="err">@</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-18">#</a>               </div>               <h2>insert</h2>

<p>Inserts a record in a table.</p>

<h3>Arguments:</h3>

<ul>
<li><strong>table</strong>: The name of the table.</li>
<li><strong>values</strong>: Key, value pairs.</li>
<li><strong>callback</strong>: The callback function</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">insert: </span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">vals</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Hash</span> <span class="nx">values</span>
    <span class="nx">valuesa</span> <span class="o">=</span> <span class="nx">vals</span><span class="p">.</span><span class="nx">getValues</span><span class="p">().</span><span class="nx">map</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="s2">&quot;&#39;#{item}&#39;&quot;</span>
    <span class="nx">keys</span> <span class="o">=</span> <span class="nx">vals</span><span class="p">.</span><span class="nx">getKeys</span><span class="p">().</span><span class="nx">map</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="s2">&quot;&#39;#{item}&#39;&quot;</span>
    <span class="nx">@exec</span> <span class="s2">&quot;INSERT INTO &#39;#{table}&#39; ( #{keys} ) VALUES ( #{valuesa} );&quot;</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-19">#</a>               </div>               <h2>remove</h2>

<p>Removes a record from a table.</p>

<h3>Arguments:</h3>

<ul>
<li><strong>table</strong>: The name of the table.</li>
<li><strong>where</strong>: Key, value pairs specifing the arguments for the WHERE clause.</li>
<li><strong>callback</strong>: The callback function</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">remove: </span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">Where</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">wheremap</span> <span class="o">=</span>  <span class="nx">@whereMap</span> <span class="nx">Where</span>
    <span class="nx">@exec</span> <span class="s2">&quot;DELETE FROM &#39;#{table}&#39; WHERE #{wheremap};&quot;</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-20">#</a>               </div>               <h2>update</h2>

<p>Updates a record in a table.</p>

<h3>Arguments:</h3>

<ul>
<li><strong>table</strong>: The name of the table.</li>
<li><strong>set</strong>: Key value pairs for the SET.</li>
<li><strong>where</strong>: Key, value pairs specifing the arguments for the WHERE clause.</li>
<li><strong>callback</strong>: The callback function</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">update: </span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">Where</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">wheremap</span> <span class="o">=</span>  <span class="nx">@whereMap</span> <span class="nx">Where</span>
    <span class="nx">setmap</span> <span class="o">=</span> <span class="nx">$splat</span><span class="p">(</span><span class="k">new</span> <span class="nx">Hash</span><span class="p">(</span><span class="nx">set</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">value</span><span class="p">,</span><span class="nx">key</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="s2">&quot;#{key}=&#39;#{value}&#39;&quot;</span>
    <span class="p">).</span><span class="nx">getValues</span><span class="p">()).</span><span class="nx">join</span> <span class="s1">&#39;, &#39;</span>
    <span class="nx">@exec</span> <span class="s2">&quot;UPDATE &#39;#{table}&#39; SET #{setmap} WHERE #{wheremap};&quot;</span><span class="p">,</span> <span class="nx">callback</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-21">#</a>               </div>               <h2>whereMap</h2>

<p>Generates "key='value' AND key='value' AND..." map of objects</p>

<h3>Arguments:</h3>

<ul>
<li><strong>wher</strong>: Key, value pairs. </li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">whereMap: </span><span class="p">(</span><span class="nx">wher</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">$splat</span><span class="p">(</span><span class="k">new</span> <span class="nx">Hash</span><span class="p">(</span><span class="nx">wher</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">value</span><span class="p">,</span><span class="nx">key</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="nx">key</span><span class="o">+</span><span class="s2">&quot;=&#39;&quot;</span><span class="o">+</span><span class="nx">value</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span>
    <span class="p">).</span><span class="nx">getValues</span><span class="p">()).</span><span class="nx">join</span> <span class="s2">&quot; AND &quot;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-22">#</a>               </div>               <h2>likeMap</h2>

<p>Generates "key LIKE 'value' AND key LIKE 'value' AND..." map of objects</p>

<h3>Arguments:</h3>

<ul>
<li><strong>wher</strong>: Key, value pairs.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">likeMap: </span><span class="p">(</span><span class="nx">wher</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">$splat</span><span class="p">(</span><span class="k">new</span> <span class="nx">Hash</span><span class="p">(</span><span class="nx">wher</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">value</span><span class="p">,</span><span class="nx">key</span><span class="p">)</span> <span class="o">-&gt;</span>
      <span class="nx">key</span><span class="o">+</span><span class="s2">&quot; LIKE &#39;&quot;</span><span class="o">+</span><span class="nx">value</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span>
    <span class="p">).</span><span class="nx">getValues</span><span class="p">()).</span><span class="nx">join</span> <span class="s2">&quot; AND &quot;</span>
<span class="p">}</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 